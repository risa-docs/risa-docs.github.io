<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RISA: glados/include/glados/pipeline/Stage.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RISA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('_stage_8h_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Stage.h</div></div>
</div><!--header-->
<div class="contents">
<a href="_stage_8h.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">// SPDX-FileCopyrightText: 2022 Helmholtz-Zentrum Dresden-Rossendorf</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">//</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">// SPDX-License-Identifier: Apache-2.0</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment">//</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment">// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment">// you may not use this file except in compliance with the License.</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment">// You may obtain a copy of the License at</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment">//</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment">//     http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment">//</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment">// Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment">// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment">// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment">// See the License for the specific language governing permissions and</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment">// limitations under the License.</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="comment">//</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="comment">// Authors: </span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="comment">// Dominic Windisch (d.windisch@hzdr.de), </span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="comment">// Andr√© Bieberle (a.bieberle@hzdr.de)</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span> </div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#ifndef GLADOS_PIPELINE_STAGE_H_</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#define GLADOS_PIPELINE_STAGE_H_</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span> </div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#include &lt;thread&gt;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span> </div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor">#include &quot;../Image.h&quot;</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span> </div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="preprocessor">#include &quot;../observer/Subject.h&quot;</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="preprocessor">#include &quot;<a class="code" href="_generic_stage_8h.html">GenericStage.h</a>&quot;</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="preprocessor">#include &quot;<a class="code" href="_input_side_8h.html">InputSide.h</a>&quot;</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="preprocessor">#include &quot;<a class="code" href="_output_side_8h.html">OutputSide.h</a>&quot;</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span> </div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceglados.html">glados</a></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>{</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="keyword">namespace </span>pipeline</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>{</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="keyword">template</span> &lt;<span class="keyword">class</span> Implementation&gt;</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno"><a class="line" href="classglados_1_1pipeline_1_1_stage.html">   39</a></span><span class="keyword">class </span><a class="code hl_class" href="classglados_1_1pipeline_1_1_stage.html">Stage</a></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>    : <span class="keyword">public</span> <a class="code hl_class" href="classglados_1_1pipeline_1_1_input_side.html">InputSide</a>&lt;typename Implementation::input_type&gt; <span class="comment">// use input_type from Implementation</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>    , <span class="keyword">public</span> <a class="code hl_class" href="classglados_1_1pipeline_1_1_output_side.html">OutputSide</a>&lt;typename Implementation::output_type&gt; <span class="comment">// use output_type from Implementation</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>    , <span class="keyword">public</span> Implementation</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>    , <span class="keyword">public</span> <a class="code hl_class" href="classglados_1_1pipeline_1_1_generic_stage.html">GenericStage</a></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>{</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>    <span class="keyword">public</span>:</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno"><a class="line" href="classglados_1_1pipeline_1_1_stage.html#aa9f2357b9b6eb5d650570fe9ab16d564">   46</a></span>    <span class="keyword">using</span> <a class="code hl_typedef" href="classglados_1_1pipeline_1_1_stage.html#aa9f2357b9b6eb5d650570fe9ab16d564">input_type</a> = <span class="keyword">typename</span> Implementation::input_type;</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno"><a class="line" href="classglados_1_1pipeline_1_1_stage.html#a9765c61a3fd9a60a8e66c704fd6cb600">   47</a></span>    <span class="keyword">using</span> <a class="code hl_typedef" href="classglados_1_1pipeline_1_1_stage.html#a9765c61a3fd9a60a8e66c704fd6cb600">output_type</a> = <span class="keyword">typename</span> Implementation::output_type;</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span> </div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>    <span class="keyword">public</span>:</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>    <span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Args&gt;</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno"><a class="line" href="classglados_1_1pipeline_1_1_stage.html#a50294b59abb676377367d3272fdf5f3c">   51</a></span>    <a class="code hl_function" href="classglados_1_1pipeline_1_1_stage.html#a50294b59abb676377367d3272fdf5f3c">Stage</a>(Args&amp;&amp;... args)</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>        : <a class="code hl_class" href="classglados_1_1pipeline_1_1_input_side.html">InputSide</a>&lt;<a class="code hl_typedef" href="classglados_1_1pipeline_1_1_stage.html#aa9f2357b9b6eb5d650570fe9ab16d564">input_type</a>&gt;()</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>        , <a class="code hl_class" href="classglados_1_1pipeline_1_1_output_side.html">OutputSide</a>&lt;<a class="code hl_typedef" href="classglados_1_1pipeline_1_1_stage.html#a9765c61a3fd9a60a8e66c704fd6cb600">output_type</a>&gt;()</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>        , Implementation(std::forward&lt;Args&gt;(args)..., 1, 1)<span class="comment">// if no numberOfInputs and numberOfOutputs is provided, default to 1 for both</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>    {</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>        <a class="code hl_variable" href="classglados_1_1pipeline_1_1_stage.html#a64d9df7f96b8419aed863a820830ed35">numberOfOutputs_</a> = 1;</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>        <a class="code hl_variable" href="classglados_1_1pipeline_1_1_stage.html#a40910bf582fede952c90a906568926ec">numberOfInputs_</a> = 1;</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>        this-&gt;<a class="code hl_variable" href="classglados_1_1pipeline_1_1_input_side.html#a825386a8aa28408adc49ec530b18e578">input_queues_</a> = std::vector&lt;glados::Queue&lt;input_type&gt;&gt;(<a class="code hl_variable" href="classglados_1_1pipeline_1_1_stage.html#a40910bf582fede952c90a906568926ec">numberOfInputs_</a>);</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>    }</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span> </div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>    <span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Args&gt;</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno"><a class="line" href="classglados_1_1pipeline_1_1_stage.html#ac928a7eef4f99c4e4819eb49d49b6e67">   62</a></span>    <a class="code hl_function" href="classglados_1_1pipeline_1_1_stage.html#ac928a7eef4f99c4e4819eb49d49b6e67">Stage</a>(<span class="keywordtype">int</span> numberOfInputs, <span class="keywordtype">int</span> numberOfOutputs, Args&amp;&amp;... args)</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>        : <a class="code hl_class" href="classglados_1_1pipeline_1_1_input_side.html">InputSide</a>&lt;<a class="code hl_typedef" href="classglados_1_1pipeline_1_1_stage.html#aa9f2357b9b6eb5d650570fe9ab16d564">input_type</a>&gt;()</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>        , <a class="code hl_class" href="classglados_1_1pipeline_1_1_output_side.html">OutputSide</a>&lt;<a class="code hl_typedef" href="classglados_1_1pipeline_1_1_stage.html#a9765c61a3fd9a60a8e66c704fd6cb600">output_type</a>&gt;()</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>        , Implementation(std::forward&lt;Args&gt;(args)..., numberOfOutputs, numberOfInputs)</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>    {</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>        <a class="code hl_variable" href="classglados_1_1pipeline_1_1_stage.html#a40910bf582fede952c90a906568926ec">numberOfInputs_</a> = numberOfInputs;</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>        <a class="code hl_variable" href="classglados_1_1pipeline_1_1_stage.html#a64d9df7f96b8419aed863a820830ed35">numberOfOutputs_</a> = numberOfOutputs;</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>        this-&gt;<a class="code hl_variable" href="classglados_1_1pipeline_1_1_input_side.html#a825386a8aa28408adc49ec530b18e578">input_queues_</a> = std::vector&lt;glados::Queue&lt;input_type&gt;&gt;(<a class="code hl_variable" href="classglados_1_1pipeline_1_1_stage.html#a40910bf582fede952c90a906568926ec">numberOfInputs_</a>);</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>    }</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span> </div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno"><a class="line" href="classglados_1_1pipeline_1_1_stage.html#a296524b1689f3892a003ab43d304f800">   72</a></span>    <span class="keyword">auto</span> <a class="code hl_function" href="classglados_1_1pipeline_1_1_stage.html#a296524b1689f3892a003ab43d304f800">run</a>() -&gt; <span class="keywordtype">void</span></div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>    {</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>        std::vector&lt;std::thread&gt; push_threads;</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>        std::vector&lt;std::thread&gt; take_threads;</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_variable" href="classglados_1_1pipeline_1_1_stage.html#a40910bf582fede952c90a906568926ec">numberOfInputs_</a>; i++)<span class="comment">// for each input</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>        {</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>            <span class="comment">// create one thread that takes items from input queue i and applies Implementation::process on the item</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>            push_threads.push_back(std::thread{&amp;<a class="code hl_function" href="classglados_1_1pipeline_1_1_stage.html#af31c4c7ca88f7407a681b6dd4eae2ad9">Stage::push</a>, <span class="keyword">this</span>, i});</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>        }</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_variable" href="classglados_1_1pipeline_1_1_stage.html#a64d9df7f96b8419aed863a820830ed35">numberOfOutputs_</a>; i++)<span class="comment">// for each output</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>        {</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>            <span class="comment">// create one thread that waits for Implementation::process to complete items and then forwards them to the ports connected at the output of this stage. This in turn will enqueue the item in the InputQueue of the Stages that are connected to the Ports receiving End.</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>            <span class="comment">// In other words, the Flow is as follows:</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>            <span class="comment">// This Stage -&gt; Port of the next stage -&gt; InputQueue of next Stage</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>            <span class="comment">// since there can be multiple outputs, i is used to distinguish them (we launch one thread per output in a loop)</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>            take_threads.push_back(std::thread{&amp;<a class="code hl_function" href="classglados_1_1pipeline_1_1_stage.html#a39cdf869ed480b346ec0a6b51a22e360">Stage::take</a>, <span class="keyword">this</span>, i});</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>        }</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span> </div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>        <span class="comment">//at this point, all in/outputs have a corresponding thread that is running and will continue to work until an invalid item arrives.</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span> </div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_variable" href="classglados_1_1pipeline_1_1_stage.html#a40910bf582fede952c90a906568926ec">numberOfInputs_</a>; i++)<span class="comment">//wait for all previously launched push threads to finish</span></div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>        {</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>            push_threads[i].join();</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>        };</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; <a class="code hl_variable" href="classglados_1_1pipeline_1_1_stage.html#a64d9df7f96b8419aed863a820830ed35">numberOfOutputs_</a>; i++)<span class="comment">//wait for all previously launched take threads to finish</span></div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>        {</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>            take_threads[i].join();</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>        };</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>    }</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span> </div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno"><a class="line" href="classglados_1_1pipeline_1_1_stage.html#af31c4c7ca88f7407a681b6dd4eae2ad9">  104</a></span>    <span class="keyword">auto</span> <a class="code hl_function" href="classglados_1_1pipeline_1_1_stage.html#af31c4c7ca88f7407a681b6dd4eae2ad9">push</a>(<span class="keywordtype">int</span> inputIdx = 0) -&gt; <span class="keywordtype">void</span></div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>    {</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>        <span class="keywordflow">while</span>(<span class="keyword">true</span>)</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>        {</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>            <span class="keyword">auto</span> img = this-&gt;<a class="code hl_variable" href="classglados_1_1pipeline_1_1_input_side.html#a825386a8aa28408adc49ec530b18e578">input_queues_</a>[inputIdx].take(); <span class="comment">//get item from the inputQueue No. inputIdx of this Stage. This will block if no item is immediately availible.</span></div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>            <span class="keywordflow">if</span>(img.valid())</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>                Implementation::process(std::move(img), inputIdx);<span class="comment">// process the item</span></div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>            {</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>                Implementation::process(std::move(img), inputIdx);<span class="comment">// forward poisonous pill to kill later stages</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>                <span class="keywordflow">break</span>;<span class="comment">// received poisonous pill, time to die</span></div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>            }</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>        }</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>    }</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span> </div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno"><a class="line" href="classglados_1_1pipeline_1_1_stage.html#a39cdf869ed480b346ec0a6b51a22e360">  120</a></span>    <span class="keyword">auto</span> <a class="code hl_function" href="classglados_1_1pipeline_1_1_stage.html#a39cdf869ed480b346ec0a6b51a22e360">take</a>(<span class="keywordtype">int</span> outputIdx = 0) -&gt; <span class="keywordtype">void</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>    {</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>        <span class="keywordflow">while</span>(<span class="keyword">true</span>)</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>        {</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>            <span class="keyword">auto</span> result = Implementation::wait(outputIdx);<span class="comment">// wait for Implementation::process to finish one item. This will block if no item is immediately availible.</span></div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>            <span class="keywordflow">if</span>(result.valid())</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>            {</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>                this-&gt;<a class="code hl_function" href="classglados_1_1pipeline_1_1_output_side.html#a9f3be0c3778af91df35c094dc40b463b">output</a>(std::move(result), outputIdx);<span class="comment">// forward it to the connected Port with id outputIdx</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>            }</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>            {</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>                this-&gt;<a class="code hl_function" href="classglados_1_1pipeline_1_1_output_side.html#a9f3be0c3778af91df35c094dc40b463b">output</a>(std::move(result), outputIdx);<span class="comment">// forward poisonous pill to kill later stages</span></div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>                <span class="keywordflow">break</span>;<span class="comment">// received poisonous pill, time to die</span></div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>            }</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>        }</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>    }</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span> </div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno"><a class="line" href="classglados_1_1pipeline_1_1_stage.html#a72169ca8eda247cd06a4d741386834fe">  137</a></span>    <span class="keyword">auto</span> <a class="code hl_function" href="classglados_1_1pipeline_1_1_stage.html#a72169ca8eda247cd06a4d741386834fe">update</a>(<a class="code hl_class" href="classglados_1_1_subject.html">Subject</a>* s) -&gt; <span class="keywordtype">void</span> { Implementation::update(s); }</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span> </div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno"><a class="line" href="classglados_1_1pipeline_1_1_stage.html#ae9a397ad2ddb05ab2e32820311f90921">  141</a></span>    <span class="keywordtype">void</span> <a class="code hl_function" href="classglados_1_1pipeline_1_1_stage.html#ae9a397ad2ddb05ab2e32820311f90921">connectTo</a>(std::shared_ptr&lt;GenericStage&gt; other_, <span class="keywordtype">int</span> inputIdx)<span class="keyword"> override</span></div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span><span class="keyword">    </span>{</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>        <span class="keyword">using</span> port_type = <a class="code hl_typedef" href="classglados_1_1pipeline_1_1_stage.html#a9765c61a3fd9a60a8e66c704fd6cb600">output_type</a>;</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>        <span class="keyword">auto</span> port = std::unique_ptr&lt;Port&lt;port_type&gt;&gt;(<span class="keyword">new</span> <a class="code hl_class" href="classglados_1_1pipeline_1_1_port.html">Port&lt;port_type&gt;</a>);</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>        <span class="keyword">auto</span> other = std::dynamic_pointer_cast&lt;InputSide&lt;output_type&gt;&gt;(other_); <span class="comment">//get the input part of the &quot;other_&quot;-Stage, save it as &quot;other&quot;</span></div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>        <span class="keywordflow">if</span>(other == <span class="keyword">nullptr</span>)</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>        {</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>            <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;input/output type mismatch.&quot;</span>);</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>        }</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span> </div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>        port-&gt;attach(other, inputIdx); <span class="comment">//tell the port to forward the data it receives to InputQueue No. &quot;inputIdx&quot; of the stage &quot;other&quot;.</span></div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>        this-&gt;<a class="code hl_function" href="classglados_1_1pipeline_1_1_output_side.html#a9357d89b6efffa8400a8327b1bfd0853">attach</a>(std::move(port)); <span class="comment">//tell this stage to output its data to the port (effectively forwarding it to &quot;other&quot; aswell)</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>    }</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span> </div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>    <span class="keyword">private</span>:</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno"><a class="line" href="classglados_1_1pipeline_1_1_stage.html#a40910bf582fede952c90a906568926ec">  156</a></span>    <span class="keywordtype">int</span> <a class="code hl_variable" href="classglados_1_1pipeline_1_1_stage.html#a40910bf582fede952c90a906568926ec">numberOfInputs_</a>; </div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno"><a class="line" href="classglados_1_1pipeline_1_1_stage.html#a64d9df7f96b8419aed863a820830ed35">  157</a></span>    <span class="keywordtype">int</span> <a class="code hl_variable" href="classglados_1_1pipeline_1_1_stage.html#a64d9df7f96b8419aed863a820830ed35">numberOfOutputs_</a>; </div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>};</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>}</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>}</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span> </div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span><span class="preprocessor">#endif </span><span class="comment">/* GLADOS_PIPELINE_STAGE_H_ */</span><span class="preprocessor"></span></div>
<div class="ttc" id="a_generic_stage_8h_html"><div class="ttname"><a href="_generic_stage_8h.html">GenericStage.h</a></div></div>
<div class="ttc" id="a_input_side_8h_html"><div class="ttname"><a href="_input_side_8h.html">InputSide.h</a></div></div>
<div class="ttc" id="a_output_side_8h_html"><div class="ttname"><a href="_output_side_8h.html">OutputSide.h</a></div></div>
<div class="ttc" id="aclassglados_1_1_subject_html"><div class="ttname"><a href="classglados_1_1_subject.html">glados::Subject</a></div><div class="ttdef"><b>Definition:</b> <a href="_subject_8h_source.html#l00030">Subject.h:31</a></div></div>
<div class="ttc" id="aclassglados_1_1pipeline_1_1_generic_stage_html"><div class="ttname"><a href="classglados_1_1pipeline_1_1_generic_stage.html">glados::pipeline::GenericStage</a></div><div class="ttdef"><b>Definition:</b> <a href="_generic_stage_8h_source.html#l00031">GenericStage.h:32</a></div></div>
<div class="ttc" id="aclassglados_1_1pipeline_1_1_input_side_html"><div class="ttname"><a href="classglados_1_1pipeline_1_1_input_side.html">glados::pipeline::InputSide</a></div><div class="ttdef"><b>Definition:</b> <a href="_input_side_8h_source.html#l00033">InputSide.h:34</a></div></div>
<div class="ttc" id="aclassglados_1_1pipeline_1_1_input_side_html_a825386a8aa28408adc49ec530b18e578"><div class="ttname"><a href="classglados_1_1pipeline_1_1_input_side.html#a825386a8aa28408adc49ec530b18e578">glados::pipeline::InputSide&lt; Implementation::input_type &gt;::input_queues_</a></div><div class="ttdeci">std::vector&lt; Queue&lt; Implementation::input_type &gt; &gt; input_queues_</div><div class="ttdef"><b>Definition:</b> <a href="_input_side_8h_source.html#l00044">InputSide.h:44</a></div></div>
<div class="ttc" id="aclassglados_1_1pipeline_1_1_output_side_html"><div class="ttname"><a href="classglados_1_1pipeline_1_1_output_side.html">glados::pipeline::OutputSide</a></div><div class="ttdef"><b>Definition:</b> <a href="_output_side_8h_source.html#l00034">OutputSide.h:35</a></div></div>
<div class="ttc" id="aclassglados_1_1pipeline_1_1_output_side_html_a9357d89b6efffa8400a8327b1bfd0853"><div class="ttname"><a href="classglados_1_1pipeline_1_1_output_side.html#a9357d89b6efffa8400a8327b1bfd0853">glados::pipeline::OutputSide&lt; Implementation::output_type &gt;::attach</a></div><div class="ttdeci">auto attach(std::unique_ptr&lt; Port&lt; Implementation::output_type &gt; &gt; &amp;&amp;port) noexcept -&gt; void</div><div class="ttdoc">connect an accepting Port to this output</div><div class="ttdef"><b>Definition:</b> <a href="_output_side_8h_source.html#l00049">OutputSide.h:49</a></div></div>
<div class="ttc" id="aclassglados_1_1pipeline_1_1_output_side_html_a9f3be0c3778af91df35c094dc40b463b"><div class="ttname"><a href="classglados_1_1pipeline_1_1_output_side.html#a9f3be0c3778af91df35c094dc40b463b">glados::pipeline::OutputSide&lt; Implementation::output_type &gt;::output</a></div><div class="ttdeci">auto output(Implementation::output_type &amp;&amp;out, int outputIdx=0) -&gt; void</div><div class="ttdef"><b>Definition:</b> <a href="_output_side_8h_source.html#l00040">OutputSide.h:40</a></div></div>
<div class="ttc" id="aclassglados_1_1pipeline_1_1_port_html"><div class="ttname"><a href="classglados_1_1pipeline_1_1_port.html">glados::pipeline::Port</a></div><div class="ttdef"><b>Definition:</b> <a href="_port_8h_source.html#l00034">Port.h:35</a></div></div>
<div class="ttc" id="aclassglados_1_1pipeline_1_1_stage_html"><div class="ttname"><a href="classglados_1_1pipeline_1_1_stage.html">glados::pipeline::Stage</a></div><div class="ttdef"><b>Definition:</b> <a href="_stage_8h_source.html#l00039">Stage.h:44</a></div></div>
<div class="ttc" id="aclassglados_1_1pipeline_1_1_stage_html_a296524b1689f3892a003ab43d304f800"><div class="ttname"><a href="classglados_1_1pipeline_1_1_stage.html#a296524b1689f3892a003ab43d304f800">glados::pipeline::Stage::run</a></div><div class="ttdeci">auto run() -&gt; void</div><div class="ttdef"><b>Definition:</b> <a href="_stage_8h_source.html#l00072">Stage.h:72</a></div></div>
<div class="ttc" id="aclassglados_1_1pipeline_1_1_stage_html_a39cdf869ed480b346ec0a6b51a22e360"><div class="ttname"><a href="classglados_1_1pipeline_1_1_stage.html#a39cdf869ed480b346ec0a6b51a22e360">glados::pipeline::Stage::take</a></div><div class="ttdeci">auto take(int outputIdx=0) -&gt; void</div><div class="ttdoc">waits for Implementation::process to finish an item and forwards it to the ports that receive from th...</div><div class="ttdef"><b>Definition:</b> <a href="_stage_8h_source.html#l00120">Stage.h:120</a></div></div>
<div class="ttc" id="aclassglados_1_1pipeline_1_1_stage_html_a40910bf582fede952c90a906568926ec"><div class="ttname"><a href="classglados_1_1pipeline_1_1_stage.html#a40910bf582fede952c90a906568926ec">glados::pipeline::Stage::numberOfInputs_</a></div><div class="ttdeci">int numberOfInputs_</div><div class="ttdef"><b>Definition:</b> <a href="_stage_8h_source.html#l00156">Stage.h:156</a></div></div>
<div class="ttc" id="aclassglados_1_1pipeline_1_1_stage_html_a50294b59abb676377367d3272fdf5f3c"><div class="ttname"><a href="classglados_1_1pipeline_1_1_stage.html#a50294b59abb676377367d3272fdf5f3c">glados::pipeline::Stage::Stage</a></div><div class="ttdeci">Stage(Args &amp;&amp;... args)</div><div class="ttdef"><b>Definition:</b> <a href="_stage_8h_source.html#l00051">Stage.h:51</a></div></div>
<div class="ttc" id="aclassglados_1_1pipeline_1_1_stage_html_a64d9df7f96b8419aed863a820830ed35"><div class="ttname"><a href="classglados_1_1pipeline_1_1_stage.html#a64d9df7f96b8419aed863a820830ed35">glados::pipeline::Stage::numberOfOutputs_</a></div><div class="ttdeci">int numberOfOutputs_</div><div class="ttdoc">How many Inputs does this Stage have (for each Input there is one Input Queue)</div><div class="ttdef"><b>Definition:</b> <a href="_stage_8h_source.html#l00157">Stage.h:157</a></div></div>
<div class="ttc" id="aclassglados_1_1pipeline_1_1_stage_html_a72169ca8eda247cd06a4d741386834fe"><div class="ttname"><a href="classglados_1_1pipeline_1_1_stage.html#a72169ca8eda247cd06a4d741386834fe">glados::pipeline::Stage::update</a></div><div class="ttdeci">auto update(Subject *s) -&gt; void</div><div class="ttdef"><b>Definition:</b> <a href="_stage_8h_source.html#l00137">Stage.h:137</a></div></div>
<div class="ttc" id="aclassglados_1_1pipeline_1_1_stage_html_a9765c61a3fd9a60a8e66c704fd6cb600"><div class="ttname"><a href="classglados_1_1pipeline_1_1_stage.html#a9765c61a3fd9a60a8e66c704fd6cb600">glados::pipeline::Stage::output_type</a></div><div class="ttdeci">typename Implementation::output_type output_type</div><div class="ttdef"><b>Definition:</b> <a href="_stage_8h_source.html#l00047">Stage.h:47</a></div></div>
<div class="ttc" id="aclassglados_1_1pipeline_1_1_stage_html_aa9f2357b9b6eb5d650570fe9ab16d564"><div class="ttname"><a href="classglados_1_1pipeline_1_1_stage.html#aa9f2357b9b6eb5d650570fe9ab16d564">glados::pipeline::Stage::input_type</a></div><div class="ttdeci">typename Implementation::input_type input_type</div><div class="ttdef"><b>Definition:</b> <a href="_stage_8h_source.html#l00046">Stage.h:46</a></div></div>
<div class="ttc" id="aclassglados_1_1pipeline_1_1_stage_html_ac928a7eef4f99c4e4819eb49d49b6e67"><div class="ttname"><a href="classglados_1_1pipeline_1_1_stage.html#ac928a7eef4f99c4e4819eb49d49b6e67">glados::pipeline::Stage::Stage</a></div><div class="ttdeci">Stage(int numberOfInputs, int numberOfOutputs, Args &amp;&amp;... args)</div><div class="ttdef"><b>Definition:</b> <a href="_stage_8h_source.html#l00062">Stage.h:62</a></div></div>
<div class="ttc" id="aclassglados_1_1pipeline_1_1_stage_html_ae9a397ad2ddb05ab2e32820311f90921"><div class="ttname"><a href="classglados_1_1pipeline_1_1_stage.html#ae9a397ad2ddb05ab2e32820311f90921">glados::pipeline::Stage::connectTo</a></div><div class="ttdeci">void connectTo(std::shared_ptr&lt; GenericStage &gt; other_, int inputIdx) override</div><div class="ttdef"><b>Definition:</b> <a href="_stage_8h_source.html#l00141">Stage.h:141</a></div></div>
<div class="ttc" id="aclassglados_1_1pipeline_1_1_stage_html_af31c4c7ca88f7407a681b6dd4eae2ad9"><div class="ttname"><a href="classglados_1_1pipeline_1_1_stage.html#af31c4c7ca88f7407a681b6dd4eae2ad9">glados::pipeline::Stage::push</a></div><div class="ttdeci">auto push(int inputIdx=0) -&gt; void</div><div class="ttdef"><b>Definition:</b> <a href="_stage_8h_source.html#l00104">Stage.h:104</a></div></div>
<div class="ttc" id="anamespaceglados_html"><div class="ttname"><a href="namespaceglados.html">glados</a></div><div class="ttdef"><b>Definition:</b> <a href="memory__layout_8h_source.html#l00024">memory_layout.h:25</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_2b3fca7a7a2cd4d509e64f38adf8c3d5.html">glados</a></li><li class="navelem"><a class="el" href="dir_183dbafc720857a15fb48bbc681b28b6.html">include</a></li><li class="navelem"><a class="el" href="dir_d2a9bc7801c978c40d924e1f5f6803cb.html">glados</a></li><li class="navelem"><a class="el" href="dir_03e2699684d161b62f3ecba148e2240d.html">pipeline</a></li><li class="navelem"><a class="el" href="_stage_8h.html">Stage.h</a></li>
    <li class="footer">Generated on Thu May 5 2022 13:18:10 for RISA by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
